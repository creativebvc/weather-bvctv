<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BVC Weather Dashboard</title>
    
    <!-- Import Poppins Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* ========================================
           CSS RESET & BASE
           ======================================== */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            height: 100vh;
            width: 100vw;
            font-family: 'Poppins', sans-serif;
            color: white;
            
            /* Background will be set by JS, default fallback */
            background: linear-gradient(45deg, #3278fe 0%, #6077f9 50%, #a370f2 100%);
            background-size: 100% 100%;
            
            /* Center the dashboard */
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            
            /* Prevent text selection for TV display */
            user-select: none;
            -webkit-user-select: none;
        }

        /* ========================================
           MAIN DASHBOARD CONTAINER
           ======================================== */
        .dashboard-container {
            /* Dimensions: 1920x1080 with 100px padding = 1720x880 */
            width: 1720px;
            height: 880px;
            flex-shrink: 0;
            
            /* Glassmorphism effect */
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 60px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.1);
            
            /* Internal padding */
            padding: 75px;
            
            display: flex;
            flex-direction: column;
        }

        /* ========================================
           HEADER SECTION
           ======================================== */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            flex-shrink: 0;
            margin-bottom: 10px;
        }

        .location-info h1 {
            font-weight: 700;
            font-size: 48px;
            line-height: 1.1;
            margin-bottom: 10px;            
        }

        .location-info h2 {
            font-weight: 400;
            font-size: 26px;
            opacity: 0.85;
            letter-spacing: 0.3px;
        }

        .branding {
            text-align: right;
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 20px;
        }

        .brought-to-you {
            font-size: 21px;
            font-weight: 400;
            opacity: 0.9;
        }

        /* Logo styling with fallback */
        .logo-container {
            width: 280px;
            height: 99px;
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }

        .logo-svg {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* ========================================
           CURRENT WEATHER SECTION
           ======================================== */
        .current-weather {
            display: flex;
            align-items: center;
            flex-grow: 0;
            justify-content: flex-start;
            gap: 50px;
            margin-bottom: 10px;
        }

        .main-temp {
            font-size: 140px;
            font-weight: 700;
            line-height: 0.9;            
        }

        .weather-icon-large {
            width: 180px;
            height: 180px;
            flex-shrink: 0;
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .weather-details {
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 8px;
        }

        .weather-desc {
            font-size: 45px;
            font-weight: 600;
            text-transform: capitalize;
            line-height: 1.2;
            letter-spacing: -0.5px;
        }

        .feels-like {
            font-size: 28px;
            font-weight: 300;
            opacity: 0.85;
        }

        /* ========================================
           FORECAST SECTION
           ======================================== */
        .forecast-row {
            display: flex;
            justify-content: space-between;
            width: 100%;
            gap: 40px;
            margin-top: auto;
        }

        .forecast-card {
            flex: 1;
            height: 340px;
            
            /* Subtle glass effect for cards */
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 40px;
            
            padding: 10px 20px 20px 20px;
            
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-evenly;
        }

        .day-name {
            font-size: 40px;
            font-weight: 600;
            letter-spacing: -0.5px;
        }

        .forecast-icon {
            width: 120px;
            height: 120px;
            flex-shrink: 0;
        }

        .temps {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
        }

        .high-temp {
            font-size: 40px;
            font-weight: 700;
            line-height: 1;
        }

        .low-temp {
            font-size: 30px;
            font-weight: 400;
            opacity: 0.75;
            line-height: 1;
        }

        /* ========================================
           LOADING & ERROR STATES
           ======================================== */
        .loading {
            opacity: 0.5;
        }

        .error-message {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 100, 100, 0.2);
            padding: 15px 30px;
            border-radius: 20px;
            font-size: 18px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* ========================================
           UTILITY CLASSES
           ======================================== */
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Hidden but accessible */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border-width: 0;
        }
    </style>
</head>
<body>

    <div class="dashboard-container">
        <!-- ========================================
             HEADER
             ======================================== -->
        <header class="header">
            <div class="location-info">
                <h1 id="city-name">Calgary, Alberta</h1>
                <h2 id="current-date">Friday, November 28</h2>
            </div>
            
            <div class="branding">
                <span class="brought-to-you">Brought to you by</span>
                <div class="logo-container">
                    <img src="icons/logo.svg" 
                         alt="Bow Valley College" 
                         class="logo-svg"
                         onerror="this.src='data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 280 99%22%3E%3Crect width=%22280%22 height=%2299%22 fill=%22%23fff%22 opacity=%220.3%22 rx=%2210%22/%3E%3Ctext x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22Poppins, sans-serif%22 font-size=%2224%22 font-weight=%22600%22 fill=%22%23fff%22%3EBow Valley%3C/text%3E%3Ctext x=%2250%25%22 y=%2270%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 font-family=%22Poppins, sans-serif%22 font-size=%2220%22 fill=%22%23fff%22%3ECollege%3C/text%3E%3C/svg%3E';">
                </div>
            </div>
        </header>

        <!-- ========================================
             CURRENT WEATHER
             ======================================== -->
        <section class="current-weather" role="region" aria-label="Current weather">
            <div class="main-temp" id="main-temp" aria-label="Current temperature">-10°</div>
            <img src="icons/day-broken-clouds.svg" 
                 alt="Weather condition icon" 
                 id="main-icon" 
                 class="weather-icon-large"
                 onerror="this.style.display='none';">
            
            <div class="weather-details">
                <div class="weather-desc" id="weather-desc">Overcast Clouds</div>
                <div class="feels-like" id="feels-like">Feels like -17°</div>
            </div>
        </section>

        <!-- ========================================
             3-DAY FORECAST
             ======================================== -->
        <section class="forecast-row" id="forecast-container" role="region" aria-label="3-day forecast">
            <!-- Forecast cards will be injected here by JavaScript -->
            <div class="forecast-card loading">
                <div class="day-name">Sat</div>
                <img src="icons/day-broken-clouds.svg" class="forecast-icon" alt="Weather icon">
                <div class="temps">
                    <div class="high-temp">--°</div>
                    <div class="low-temp">--°</div>
                </div>
            </div>
            <div class="forecast-card loading">
                <div class="day-name">Sun</div>
                <img src="icons/day-broken-clouds.svg" class="forecast-icon" alt="Weather icon">
                <div class="temps">
                    <div class="high-temp">--°</div>
                    <div class="low-temp">--°</div>
                </div>
            </div>
            <div class="forecast-card loading">
                <div class="day-name">Mon</div>
                <img src="icons/day-broken-clouds.svg" class="forecast-icon" alt="Weather icon">
                <div class="temps">
                    <div class="high-temp">--°</div>
                    <div class="low-temp">--°</div>
                </div>
            </div>
        </section>
    </div>

    <!-- Error message container -->
    <div class="error-message" id="error-message" role="alert"></div>

    <!-- ========================================
         JAVASCRIPT
         ======================================== -->
    <script>
        // ========================================
        // Configuration
        // ========================================
        const CONFIG = {
            API_KEY: '597f4bddb6a3c7f1895b1d7ecaf07912',
            CITY: 'Calgary',
            UNITS: 'metric',
            UPDATE_INTERVAL: 1800000, // 30 minutes
            RETRY_DELAY: 60000, // 1 minute on error
        };

        // ========================================
        // Icon Mapping
        // ========================================
        const ICON_MAP = {
            '01d': 'day-clear-sky.svg',
            '01n': 'night-clear-sky.svg',
            '02d': 'day-few-clouds.svg',
            '02n': 'night-few-clouds.svg',
            '03d': 'day-scattered-clouds.svg',
            '03n': 'day-scattered-clouds.svg',
            '04d': 'day-broken-clouds.svg',
            '04n': 'day-broken-clouds.svg',
            '09d': 'day-shower-rain.svg',
            '09n': 'night-rain.svg',
            '10d': 'day-rain.svg',
            '10n': 'night-rain.svg',
            '11d': 'day-thunderstorm.svg',
            '11n': 'day-thunderstorm.svg',
            '13d': 'night-snow.svg',
            '13n': 'night-snow.svg',
            '50d': 'night-mist.svg',
            '50n': 'night-mist.svg'
        };

        // ========================================
        // Utility Functions
        // ========================================
        
        /**
         * Update background based on time (Day: 8am-8pm, Night: 8pm-8am)
         */
        function updateBackground() {
            const hour = new Date().getHours();
            const isDay = hour >= 8 && hour < 20;
            
            const dayGradient = 'linear-gradient(45deg, #3278fe 0%, #6077f9 50%, #a370f2 100%)';
            const nightGradient = 'linear-gradient(45deg, #133881 0%, #1936a3 50%, #252dcc 100%)';
            
            document.body.style.background = isDay ? dayGradient : nightGradient;
            document.body.style.backgroundSize = '100% 100%';
        }

        /**
         * Get local icon path with fallback to OpenWeather CDN
         */
        function getIconPath(code) {
            const fileName = ICON_MAP[code] || 'day-clear-sky.svg';
            return `icons/${fileName}`;
        }

        /**
         * Get fallback icon URL from OpenWeather
         */
        function getFallbackIcon(code) {
            return `https://openweathermap.org/img/wn/${code}@4x.png`;
        }

        /**
         * Format date as "Weekday, Month Day"
         */
        function getFormattedDate(dateObj) {
            const options = { weekday: 'long', month: 'long', day: 'numeric' };
            return dateObj.toLocaleDateString('en-US', options);
        }

        /**
         * Get short day name (e.g., "Sat")
         */
        function getDayName(dateObj) {
            return dateObj.toLocaleDateString('en-US', { weekday: 'short' });
        }

        /**
         * Round temperature and format with degree symbol
         */
        function formatTemp(temp) {
            return `${Math.round(temp)}°`;
        }

        /**
         * Show error message to user
         */
        function showError(message) {
            const errorEl = document.getElementById('error-message');
            errorEl.textContent = message;
            errorEl.classList.add('show');
            setTimeout(() => errorEl.classList.remove('show'), 5000);
        }

        /**
         * Log error with timestamp
         */
        function logError(context, error) {
            console.error(`[${new Date().toISOString()}] ${context}:`, error);
        }

        // ========================================
        // API Functions
        // ========================================
        
        /**
         * Fetch current weather data
         */
        async function fetchCurrentWeather() {
            const url = `https://api.openweathermap.org/data/2.5/weather?q=${CONFIG.CITY}&units=${CONFIG.UNITS}&appid=${CONFIG.API_KEY}`;
            const response = await fetch(url);
            
            if (!response.ok) {
                throw new Error(`Weather API returned ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.cod !== 200) {
                throw new Error(`Weather API error: ${data.message || 'Unknown error'}`);
            }
            
            return data;
        }

        /**
         * Fetch forecast data
         */
        async function fetchForecast() {
            const url = `https://api.openweathermap.org/data/2.5/forecast?q=${CONFIG.CITY}&units=${CONFIG.UNITS}&appid=${CONFIG.API_KEY}`;
            const response = await fetch(url);
            
            if (!response.ok) {
                throw new Error(`Forecast API returned ${response.status}`);
            }
            
            const data = await response.json();
            
            if (data.cod !== "200") {
                throw new Error(`Forecast API error: ${data.message || 'Unknown error'}`);
            }
            
            return data.list;
        }

        /**
         * Main function to fetch all weather data
         */
        async function fetchWeatherData() {
            try {
                // Fetch both current weather and forecast in parallel
                const [currentWeather, forecastList] = await Promise.all([
                    fetchCurrentWeather(),
                    fetchForecast()
                ]);
                
                updateCurrentWeather(currentWeather);
                updateForecast(forecastList);
                
            } catch (error) {
                logError('fetchWeatherData', error);
                showError('Unable to load weather data. Retrying...');
                
                // Retry after delay
                setTimeout(fetchWeatherData, CONFIG.RETRY_DELAY);
            }
        }

        // ========================================
        // UI Update Functions
        // ========================================
        
        /**
         * Update current weather display
         */
        function updateCurrentWeather(data) {
            try {
                // Update date
                const now = new Date();
                document.getElementById('current-date').textContent = getFormattedDate(now);
                
                // Update city name
                document.getElementById('city-name').textContent = `${data.name}, Alberta`;
                
                // Update temperature
                document.getElementById('main-temp').textContent = formatTemp(data.main.temp);
                
                // Update description
                const description = data.weather[0].description;
                document.getElementById('weather-desc').textContent = description;
                
                // Update feels like
                document.getElementById('feels-like').textContent = `Feels like ${formatTemp(data.main.feels_like)}`;
                
                // Update weather icon
                const iconCode = data.weather[0].icon;
                const iconEl = document.getElementById('main-icon');
                iconEl.src = getIconPath(iconCode);
                iconEl.style.display = 'block';
                iconEl.onerror = function() {
                    this.src = getFallbackIcon(iconCode);
                };
                
            } catch (error) {
                logError('updateCurrentWeather', error);
            }
        }

        /**
         * Process and update forecast display
         */
        function updateForecast(forecastList) {
            try {
                // Group forecast data by day
                const dailyData = {};
                const today = new Date().toISOString().split('T')[0];

                forecastList.forEach(item => {
                    const date = item.dt_txt.split(' ')[0];
                    
                    // Skip today
                    if (date === today) return;
                    
                    // Initialize day data
                    if (!dailyData[date]) {
                        dailyData[date] = {
                            temps: [],
                            icon: item.weather[0].icon
                        };
                    }
                    
                    // Collect temperatures
                    dailyData[date].temps.push(item.main.temp);
                    
                    // Use midday icon (12:00) if available
                    if (item.dt_txt.includes("12:00:00")) {
                        dailyData[date].icon = item.weather[0].icon;
                    }
                });

                // Get next 3 days
                const days = Object.keys(dailyData).slice(0, 3);
                const container = document.getElementById('forecast-container');
                container.innerHTML = '';

                // Create forecast cards
                days.forEach(dayDate => {
                    const dayInfo = dailyData[dayDate];
                    const min = Math.round(Math.min(...dayInfo.temps));
                    const max = Math.round(Math.max(...dayInfo.temps));
                    const dayName = getDayName(new Date(dayDate + 'T12:00:00'));
                    const iconSrc = getIconPath(dayInfo.icon);
                    const fallbackSrc = getFallbackIcon(dayInfo.icon);

                    const card = document.createElement('div');
                    card.className = 'forecast-card fade-in';
                    card.innerHTML = `
                        <div class="day-name">${dayName}</div>
                        <img src="${iconSrc}" 
                             class="forecast-icon" 
                             alt="Weather icon for ${dayName}"
                             onerror="this.src='${fallbackSrc}'">
                        <div class="temps">
                            <div class="high-temp">${max}°</div>
                            <div class="low-temp">${min}°</div>
                        </div>
                    `;
                    
                    container.appendChild(card);
                });
                
            } catch (error) {
                logError('updateForecast', error);
            }
        }

        // ========================================
        // Initialization
        // ========================================
        
        // Fetch weather data immediately on load
        fetchWeatherData();
        updateBackground();
        
        // Set up periodic updates
        setInterval(fetchWeatherData, CONFIG.UPDATE_INTERVAL);
        setInterval(updateBackground, 60000); // Check background every minute
        
        // Log initialization
        console.log(`Weather Dashboard initialized for ${CONFIG.CITY}`);
        console.log(`Updates every ${CONFIG.UPDATE_INTERVAL / 60000} minutes`);
        
    </script>
</body>
</html>
